<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Keywords.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jbehave-core</a> &gt; <a href="index.source.html" class="el_package">org.jbehave.core.configuration</a> &gt; <span class="el_source">Keywords.java</span></div><h1>Keywords.java</h1><pre class="source lang-java linenums">package org.jbehave.core.configuration;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.commons.lang.builder.ToStringBuilder;
import org.apache.commons.lang.builder.ToStringStyle;
import org.jbehave.core.steps.StepType;

import static java.util.Arrays.asList;

/**
 * Provides the keywords which allow parsers to find steps in stories and match
 * those steps with candidates through the annotations. It provides the starting
 * words (Given, When, Then And, &quot;!--&quot;) using in parsing, as well as providing
 * keywords used in reporting.
 */
public class Keywords {

    private static final String SYNONYM_SEPARATOR = &quot;\\|&quot;;
    
    public static final String META = &quot;Meta&quot;;
    public static final String META_PROPERTY = &quot;MetaProperty&quot;;
    public static final String NARRATIVE = &quot;Narrative&quot;;
    public static final String IN_ORDER_TO = &quot;InOrderTo&quot;;
    public static final String AS_A = &quot;AsA&quot;;
    public static final String I_WANT_TO = &quot;IWantTo&quot;;
    public static final String SO_THAT = &quot;SoThat&quot;;
    public static final String SCENARIO = &quot;Scenario&quot;;
    public static final String GIVEN_STORIES = &quot;GivenStories&quot;;
    public static final String LIFECYCLE = &quot;Lifecycle&quot;;
    public static final String BEFORE = &quot;Before&quot;;
    public static final String AFTER = &quot;After&quot;;
    public static final String EXAMPLES_TABLE = &quot;ExamplesTable&quot;;
    public static final String EXAMPLES_TABLE_ROW = &quot;ExamplesTableRow&quot;;
    public static final String EXAMPLES_TABLE_HEADER_SEPARATOR = &quot;ExamplesTableHeaderSeparator&quot;;
    public static final String EXAMPLES_TABLE_VALUE_SEPARATOR = &quot;ExamplesTableValueSeparator&quot;;
    public static final String EXAMPLES_TABLE_IGNORABLE_SEPARATOR = &quot;ExamplesTableIgnorableSeparator&quot;;
    public static final String GIVEN = &quot;Given&quot;;
    public static final String WHEN = &quot;When&quot;;
    public static final String THEN = &quot;Then&quot;;
    public static final String AND = &quot;And&quot;;
    public static final String IGNORABLE = &quot;Ignorable&quot;;
    public static final String PENDING = &quot;Pending&quot;;
    public static final String NOT_PERFORMED = &quot;NotPerformed&quot;;
    public static final String FAILED = &quot;Failed&quot;;
    public static final String DRY_RUN = &quot;DryRun&quot;;
    public static final String STORY_CANCELLED = &quot;StoryCancelled&quot;;
    public static final String DURATION = &quot;Duration&quot;;
    public static final String OUTCOME_DESCRIPTION = &quot;OutcomeDescription&quot;;
    public static final String OUTCOME_VALUE = &quot;OutcomeValue&quot;;
    public static final String OUTCOME_MATCHER = &quot;OutcomeMatcher&quot;;
    public static final String OUTCOME_VERIFIED = &quot;OutcomeVerified&quot;;
    public static final String YES = &quot;Yes&quot;;
    public static final String NO = &quot;No&quot;;

<span class="fc" id="L59">    public static final List&lt;String&gt; KEYWORDS = asList(META, META_PROPERTY, NARRATIVE, IN_ORDER_TO, AS_A, I_WANT_TO, SO_THAT,</span>
            SCENARIO, GIVEN_STORIES, LIFECYCLE, BEFORE, AFTER, EXAMPLES_TABLE, EXAMPLES_TABLE_ROW, EXAMPLES_TABLE_HEADER_SEPARATOR,
            EXAMPLES_TABLE_VALUE_SEPARATOR, EXAMPLES_TABLE_IGNORABLE_SEPARATOR, GIVEN, WHEN, THEN, AND, IGNORABLE,
            PENDING, NOT_PERFORMED, FAILED, DRY_RUN, STORY_CANCELLED, DURATION, OUTCOME_DESCRIPTION, OUTCOME_VALUE,
            OUTCOME_MATCHER, OUTCOME_VERIFIED, YES, NO);


    private final String meta;
    private final String metaProperty;
    private final String narrative;
    private final String inOrderTo;
    private final String asA;
    private final String iWantTo;
    private final String soThat;
    private final String scenario;
    private final String givenStories;
    private final String lifecycle;
    private final String before;
    private final String after;
    private final String examplesTable;
    private final String examplesTableRow;
    private final String examplesTableHeaderSeparator;
    private final String examplesTableValueSeparator;
    private final String examplesTableIgnorableSeparator;
    private final String given;
    private final String when;
    private final String then;
    private final String and;
    private final String ignorable;
    private final String pending;
    private final String notPerformed;
    private final String failed;
    private final String dryRun;
    private final String storyCancelled;
    private final String duration;
    private final String outcomeDescription;
    private final String outcomeValue;
    private final String outcomeMatcher;
    private final String outcomeVerified;
    private final String yes;
    private final String no;
<span class="fc" id="L100">    private final Map&lt;StepType, String&gt; startingWordsByType = new HashMap&lt;StepType, String&gt;();</span>


    public static Map&lt;String, String&gt; defaultKeywords() {
<span class="fc" id="L104">        Map&lt;String, String&gt; keywords = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L105">        keywords.put(META, &quot;Meta:&quot;);</span>
<span class="fc" id="L106">        keywords.put(META_PROPERTY, &quot;@&quot;);</span>
<span class="fc" id="L107">        keywords.put(NARRATIVE, &quot;Narrative:&quot;);</span>
<span class="fc" id="L108">        keywords.put(IN_ORDER_TO, &quot;In order to&quot;);</span>
<span class="fc" id="L109">        keywords.put(AS_A, &quot;As a&quot;);</span>
<span class="fc" id="L110">        keywords.put(I_WANT_TO, &quot;I want to&quot;);</span>
<span class="fc" id="L111">        keywords.put(SO_THAT, &quot;So that&quot;);</span>
<span class="fc" id="L112">        keywords.put(SCENARIO, &quot;Scenario:&quot;);</span>
<span class="fc" id="L113">        keywords.put(GIVEN_STORIES, &quot;GivenStories:&quot;);</span>
<span class="fc" id="L114">        keywords.put(LIFECYCLE, &quot;Lifecycle:&quot;);</span>
<span class="fc" id="L115">        keywords.put(BEFORE, &quot;Before:&quot;);</span>
<span class="fc" id="L116">        keywords.put(AFTER, &quot;After:&quot;);</span>
<span class="fc" id="L117">        keywords.put(EXAMPLES_TABLE, &quot;Examples:&quot;);</span>
<span class="fc" id="L118">        keywords.put(EXAMPLES_TABLE_ROW, &quot;Example:&quot;);</span>
<span class="fc" id="L119">        keywords.put(EXAMPLES_TABLE_HEADER_SEPARATOR, &quot;|&quot;);</span>
<span class="fc" id="L120">        keywords.put(EXAMPLES_TABLE_VALUE_SEPARATOR, &quot;|&quot;);</span>
<span class="fc" id="L121">        keywords.put(EXAMPLES_TABLE_IGNORABLE_SEPARATOR, &quot;|--&quot;);</span>
<span class="fc" id="L122">        keywords.put(GIVEN, &quot;Given&quot;);</span>
<span class="fc" id="L123">        keywords.put(WHEN, &quot;When&quot;);</span>
<span class="fc" id="L124">        keywords.put(THEN, &quot;Then&quot;);</span>
<span class="fc" id="L125">        keywords.put(AND, &quot;And&quot;);</span>
<span class="fc" id="L126">        keywords.put(IGNORABLE, &quot;!--&quot;);</span>
<span class="fc" id="L127">        keywords.put(PENDING, &quot;PENDING&quot;);</span>
<span class="fc" id="L128">        keywords.put(NOT_PERFORMED, &quot;NOT PERFORMED&quot;);</span>
<span class="fc" id="L129">        keywords.put(FAILED, &quot;FAILED&quot;);</span>
<span class="fc" id="L130">        keywords.put(DRY_RUN, &quot;DRY RUN&quot;);</span>
<span class="fc" id="L131">        keywords.put(STORY_CANCELLED, &quot;STORY CANCELLED&quot;);</span>
<span class="fc" id="L132">        keywords.put(DURATION, &quot;DURATION&quot;);</span>
<span class="fc" id="L133">        keywords.put(OUTCOME_DESCRIPTION, &quot;DESCRIPTION&quot;);</span>
<span class="fc" id="L134">        keywords.put(OUTCOME_MATCHER, &quot;MATCHER&quot;);</span>
<span class="fc" id="L135">        keywords.put(OUTCOME_VALUE, &quot;VALUE&quot;);</span>
<span class="fc" id="L136">        keywords.put(OUTCOME_VERIFIED, &quot;VERIFIED&quot;);</span>
<span class="fc" id="L137">        keywords.put(YES, &quot;Yes&quot;);</span>
<span class="fc" id="L138">        keywords.put(NO, &quot;No&quot;);</span>
<span class="fc" id="L139">        return keywords;</span>
    }

    /**
     * Creates Keywords with default values {@link #defaultKeywords()}
     */
    public Keywords() {
<span class="fc" id="L146">        this(defaultKeywords());</span>
<span class="fc" id="L147">    }</span>

    /**
     * Creates Keywords with provided keywords Map and Encoding
     * 
     * @param keywords the Map of keywords indexed by their name
     */
<span class="fc" id="L154">    public Keywords(Map&lt;String, String&gt; keywords) {</span>
<span class="fc" id="L155">        this.meta = keyword(META, keywords);</span>
<span class="fc" id="L156">        this.metaProperty = keyword(META_PROPERTY, keywords);</span>
<span class="fc" id="L157">        this.narrative = keyword(NARRATIVE, keywords);</span>
<span class="fc" id="L158">        this.inOrderTo = keyword(IN_ORDER_TO, keywords);</span>
<span class="fc" id="L159">        this.asA = keyword(AS_A, keywords);</span>
<span class="fc" id="L160">        this.iWantTo = keyword(I_WANT_TO, keywords);</span>
<span class="fc" id="L161">        this.soThat = keyword(SO_THAT, keywords);</span>
<span class="fc" id="L162">        this.scenario = keyword(SCENARIO, keywords);</span>
<span class="fc" id="L163">        this.givenStories = keyword(GIVEN_STORIES, keywords);</span>
<span class="fc" id="L164">        this.lifecycle = keyword(LIFECYCLE, keywords);</span>
<span class="fc" id="L165">        this.before = keyword(BEFORE, keywords);</span>
<span class="fc" id="L166">        this.after = keyword(AFTER, keywords);</span>
<span class="fc" id="L167">        this.examplesTable = keyword(EXAMPLES_TABLE, keywords);</span>
<span class="fc" id="L168">        this.examplesTableRow = keyword(EXAMPLES_TABLE_ROW, keywords);</span>
<span class="fc" id="L169">        this.examplesTableHeaderSeparator = keyword(EXAMPLES_TABLE_HEADER_SEPARATOR, keywords);</span>
<span class="fc" id="L170">        this.examplesTableValueSeparator = keyword(EXAMPLES_TABLE_VALUE_SEPARATOR, keywords);</span>
<span class="fc" id="L171">        this.examplesTableIgnorableSeparator = keyword(EXAMPLES_TABLE_IGNORABLE_SEPARATOR, keywords);</span>
<span class="fc" id="L172">        this.given = keyword(GIVEN, keywords);</span>
<span class="fc" id="L173">        this.when = keyword(WHEN, keywords);</span>
<span class="fc" id="L174">        this.then = keyword(THEN, keywords);</span>
<span class="fc" id="L175">        this.and = keyword(AND, keywords);</span>
<span class="fc" id="L176">        this.ignorable = keyword(IGNORABLE, keywords);</span>
<span class="fc" id="L177">        this.pending = keyword(PENDING, keywords);</span>
<span class="fc" id="L178">        this.notPerformed = keyword(NOT_PERFORMED, keywords);</span>
<span class="fc" id="L179">        this.failed = keyword(FAILED, keywords);</span>
<span class="fc" id="L180">        this.dryRun = keyword(DRY_RUN, keywords);</span>
<span class="fc" id="L181">        this.storyCancelled = keyword(STORY_CANCELLED, keywords);</span>
<span class="fc" id="L182">        this.duration = keyword(DURATION, keywords);</span>
<span class="fc" id="L183">        this.outcomeDescription = keyword(OUTCOME_DESCRIPTION, keywords);</span>
<span class="fc" id="L184">        this.outcomeMatcher = keyword(OUTCOME_MATCHER, keywords);</span>
<span class="fc" id="L185">        this.outcomeValue = keyword(OUTCOME_VALUE, keywords);</span>
<span class="fc" id="L186">        this.outcomeVerified = keyword(OUTCOME_VERIFIED, keywords);</span>
<span class="fc" id="L187">        this.yes = keyword(YES, keywords);</span>
<span class="fc" id="L188">        this.no = keyword(NO, keywords);</span>

<span class="fc" id="L190">        startingWordsByType.put(StepType.GIVEN, given());</span>
<span class="fc" id="L191">        startingWordsByType.put(StepType.WHEN, when());</span>
<span class="fc" id="L192">        startingWordsByType.put(StepType.THEN, then());</span>
<span class="fc" id="L193">        startingWordsByType.put(StepType.AND, and());</span>
<span class="fc" id="L194">        startingWordsByType.put(StepType.IGNORABLE, ignorable());</span>

<span class="fc" id="L196">    }</span>

    private String keyword(String name, Map&lt;String, String&gt; keywords) {
<span class="fc" id="L199">        String keyword = keywords.get(name);</span>
<span class="fc bfc" id="L200" title="All 2 branches covered.">        if (keyword == null) {</span>
<span class="fc" id="L201">            throw new KeywordNotFound(name, keywords);</span>
        }
<span class="fc" id="L203">        return keyword;</span>
    }

    public String meta() {
<span class="fc" id="L207">        return meta;</span>
    }

    public String metaProperty() {
<span class="fc" id="L211">        return metaProperty;</span>
    }

    public String narrative() {
<span class="fc" id="L215">        return narrative;</span>
    }

    public String inOrderTo() {
<span class="fc" id="L219">        return inOrderTo;</span>
    }

    public String asA() {
<span class="fc" id="L223">        return asA;</span>
    }

    public String iWantTo() {
<span class="fc" id="L227">        return iWantTo;</span>
    }

    public String soThat() {
<span class="fc" id="L231">        return soThat;</span>
    }

    public String scenario() {
<span class="fc" id="L235">        return scenario;</span>
    }

    public String givenStories() {
<span class="fc" id="L239">        return givenStories;</span>
    }

    public String lifecycle() {
<span class="fc" id="L243">        return lifecycle;</span>
    }

    public String before() {
<span class="fc" id="L247">        return before;</span>
    }

    public String after() {
<span class="fc" id="L251">        return after;</span>
    }

    public String examplesTable() {
<span class="fc" id="L255">        return examplesTable;</span>
    }

    public String examplesTableRow() {
<span class="fc" id="L259">        return examplesTableRow;</span>
    }

    public String examplesTableHeaderSeparator() {
<span class="fc" id="L263">        return examplesTableHeaderSeparator;</span>
    }

    public String examplesTableValueSeparator() {
<span class="fc" id="L267">        return examplesTableValueSeparator;</span>
    }

    public String examplesTableIgnorableSeparator() {
<span class="fc" id="L271">        return examplesTableIgnorableSeparator;</span>
    }

    public String given() {
<span class="fc" id="L275">        return given;</span>
    }

    public String when() {
<span class="fc" id="L279">        return when;</span>
    }

    public String then() {
<span class="fc" id="L283">        return then;</span>
    }

    public String and() {
<span class="fc" id="L287">        return and;</span>
    }

    public String ignorable() {
<span class="fc" id="L291">        return ignorable;</span>
    }

    public String pending() {
<span class="fc" id="L295">        return pending;</span>
    }

    public String notPerformed() {
<span class="fc" id="L299">        return notPerformed;</span>
    }

    public String failed() {
<span class="fc" id="L303">        return failed;</span>
    }

    public String dryRun() {
<span class="fc" id="L307">        return dryRun;</span>
    }

    public String storyCancelled() {
<span class="fc" id="L311">        return storyCancelled;</span>
    }

    public String duration() {
<span class="fc" id="L315">        return duration;</span>
    }

    public List&lt;String&gt; outcomeFields() {
<span class="fc" id="L319">        return asList(outcomeDescription, outcomeValue, outcomeMatcher, outcomeVerified);</span>
    }

    public String yes() {
<span class="nc" id="L323">        return yes;</span>
    }

    public String no() {
<span class="fc" id="L327">        return no;</span>
    }

    public String[] synonymsOf(String word) {
<span class="fc" id="L331">        return word.split(SYNONYM_SEPARATOR);</span>
    }

    public String[] startingWords() {
<span class="fc" id="L335">        List&lt;String&gt; words = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L336" title="All 2 branches covered.">        for (String word : startingWordsByType().values()) {</span>
<span class="fc" id="L337">            words.addAll(asList(synonymsOf(word)));</span>
<span class="fc" id="L338">        }</span>
<span class="fc" id="L339">        return words.toArray(new String[words.size()]);</span>
    }

    public Map&lt;StepType, String&gt; startingWordsByType() {
<span class="fc" id="L343">        return startingWordsByType;</span>
    }

    private boolean ofStepType(String stepAsString, StepType stepType) {
<span class="fc" id="L347">        boolean isType = false;</span>
<span class="fc bfc" id="L348" title="All 2 branches covered.">        for (String word : startingWordsFor(stepType)) {</span>
<span class="fc" id="L349">            isType = stepStartsWithWord(stepAsString, word);</span>
<span class="fc bfc" id="L350" title="All 2 branches covered.">            if (isType)</span>
<span class="fc" id="L351">                break;</span>
        }
<span class="fc" id="L353">        return isType;</span>
    }

    public boolean isAndStep(String stepAsString) {
<span class="fc" id="L357">        return ofStepType(stepAsString, StepType.AND);</span>
    }

    public boolean isIgnorableStep(String stepAsString) {
<span class="fc" id="L361">        return ofStepType(stepAsString, StepType.IGNORABLE);</span>
    }

    public String stepWithoutStartingWord(String stepAsString, StepType stepType) {
<span class="fc" id="L365">        String startingWord = startingWord(stepAsString, stepType);</span>
<span class="fc" id="L366">        return stepAsString.substring(startingWord.length() + 1); // 1 for the</span>
                                                                  // space after
    }

    public String startingWord(String stepAsString, StepType stepType) throws StartingWordNotFound {
<span class="fc bfc" id="L371" title="All 2 branches covered.">        for (String wordForType : startingWordsFor(stepType)) {</span>
<span class="fc bfc" id="L372" title="All 2 branches covered.">            if (stepStartsWithWord(stepAsString, wordForType)) {</span>
<span class="fc" id="L373">                return wordForType;</span>
            }
        }
<span class="fc bfc" id="L376" title="All 2 branches covered.">        for (String andWord : startingWordsFor(StepType.AND)) {</span>
<span class="fc bfc" id="L377" title="All 2 branches covered.">            if (stepStartsWithWord(stepAsString, andWord)) {</span>
<span class="fc" id="L378">                return andWord;</span>
            }
        }
<span class="fc" id="L381">        throw new StartingWordNotFound(stepAsString, stepType, startingWordsByType);</span>
    }

    public String startingWord(String stepAsString) throws StartingWordNotFound {
<span class="nc bnc" id="L385" title="All 2 branches missed.">        for (StepType stepType : startingWordsByType.keySet()) {</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">            for (String wordForType : startingWordsFor(stepType)) {</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">                if (stepStartsWithWord(stepAsString, wordForType)) {</span>
<span class="nc" id="L388">                    return wordForType;</span>
                }
            }
<span class="nc" id="L391">        }</span>
<span class="nc" id="L392">        throw new StartingWordNotFound(stepAsString, startingWordsByType);</span>
    }

    public StepType stepTypeFor(String stepAsString) throws StartingWordNotFound {
<span class="pc bpc" id="L396" title="1 of 2 branches missed.">        for (StepType stepType : startingWordsByType.keySet()) {</span>
<span class="fc bfc" id="L397" title="All 2 branches covered.">            for (String wordForType : startingWordsFor(stepType)) {</span>
<span class="fc bfc" id="L398" title="All 2 branches covered.">                if (stepStartsWithWord(stepAsString, wordForType)) {</span>
<span class="fc" id="L399">                    return stepType;</span>
                }
            }
<span class="fc" id="L402">        }</span>
<span class="nc" id="L403">        throw new StartingWordNotFound(stepAsString, startingWordsByType);</span>
    }

    public boolean stepStartsWithWord(String step, String word) {
<span class="fc" id="L407">        return step.startsWith(word + &quot; &quot;); // space after qualifies it as word</span>
    }

    public String startingWordFor(StepType stepType) {
<span class="fc" id="L411">        String startingWord = startingWordsByType.get(stepType);</span>
<span class="pc bpc" id="L412" title="1 of 2 branches missed.">        if (startingWord == null) {</span>
<span class="nc" id="L413">            throw new StartingWordNotFound(stepType, startingWordsByType);</span>
        }
<span class="fc" id="L415">        return startingWord;</span>
    }

    public String[] startingWordsFor(StepType stepType) {
<span class="fc" id="L419">        return synonymsOf(startingWordFor(stepType));</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L424">        return ToStringBuilder.reflectionToString(this, ToStringStyle.SHORT_PREFIX_STYLE);</span>
    }

    @SuppressWarnings(&quot;serial&quot;)
    public static class KeywordNotFound extends RuntimeException {

        public KeywordNotFound(String name, Map&lt;String, String&gt; keywords) {
<span class="fc" id="L431">            super(&quot;Keyword &quot; + name + &quot; not found amongst &quot; + keywords);</span>
<span class="fc" id="L432">        }</span>

    }

    @SuppressWarnings(&quot;serial&quot;)
    public static class StartingWordNotFound extends RuntimeException {

        public StartingWordNotFound(String step, StepType stepType, Map&lt;StepType, String&gt; startingWordsByType) {
<span class="fc" id="L440">            super(&quot;No starting word found for step '&quot; + step + &quot;' of type '&quot; + stepType + &quot;' amongst '&quot;</span>
                    + startingWordsByType + &quot;'&quot;);
<span class="fc" id="L442">        }</span>

        public StartingWordNotFound(String step, Map&lt;StepType, String&gt; startingWordsByType) {
<span class="nc" id="L445">            super(&quot;No starting word found for step '&quot; + step + &quot;' amongst '&quot; + startingWordsByType + &quot;'&quot;);</span>
<span class="nc" id="L446">        }</span>

        public StartingWordNotFound(StepType stepType, Map&lt;StepType, String&gt; startingWordsByType) {
<span class="fc" id="L449">            super(&quot;No starting word found of type '&quot; + stepType + &quot;' amongst '&quot; + startingWordsByType + &quot;'&quot;);</span>
<span class="fc" id="L450">        }</span>

    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.0.201403182114</span></div></body></html>